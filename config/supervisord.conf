[supervisord]
nodaemon=true

[program:pocketbase]
command=/pb/pocketbase serve --http=0.0.0.0:8080
stopsignal=SIGTERM
stopasgroup=true
killasgroup=true
autostart=true
autorestart=true
priority=10

[program:nginx]
command=nginx -g 'daemon off;'
stopsignal=SIGTERM
autostart=true
autorestart=true
priority=20
depends_on=pocketbase

[program:node]
command=node /functions/dist/index.js
startretries=10        ; Allow up to 10 rapid restart attempts before giving up
restartsecs=6          ; Wait 5 seconds between restart attempts
stopsignal=SIGTERM
autostart=true
autorestart=true
priority=30
depends_on=pocketbase